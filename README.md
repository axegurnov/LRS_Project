# LRS_Project
LRS Project
by ImageSpark<br>
В корневом каталоге LRS_Project находятся несколько подкаталогов app, js, css, img
 - подкаталог app содержит основной модуль приложения
 - подкаталог css содержит все общедоступные CSS-файлы;
 - подкаталог js хранит общедоступные JavaScript-файлы;
<ul>
    <li>app/</li>
    <ul>
        <li>controllers/</li>
        <li>core/</li>
        <li> lib/</li>
        <li> models/</li>
        <li>public/</li>
        <ul>
            <li>views/</li>
            <ul><li>layouts</li></ul>
            <li>css</li>
            <li>js</li>
        </ul>
    </ul>
</ul>

  
Директория app содержит подкаталоги config, controllers, core, lib, models, views
 - подкаталог config содержит вспомогательныу файлы для отладки ошибок и осуществления миграции базы данных
 - подкаталог controllers содержит все контроллеры
 - подкаталог core содержит родительские классы Model, View, Controller
 - подкаталог lib содержит файлы подключаемых библиотек
 - подкаталог models содержит все необходимые модели
 - подкаталог views содержит все необходимые представления

=======
1. How to use Migrations
Create database name LRS. In file index.php uncommented //require 'app/config/Migration.php'.
Migrations in file /app/config/Migration.php.

2. Класс Controller - данный класс является родителем для всех контроллеров, используемых в программе. В него вынесены все основные функции, дублирующиеся в потомках.
Используемые параметры:
- $model, $view - подключаемые модели и вью соответственно
- $route - путь, принимаемый из роутера и используемый в качестве автоподключения модели и вью
- $table - сущность, указываемая при вызове дочернего контроллера и используемая далее в модели

а) public function __construct($route) - Функция принимает в качестве параметра путь, задаваемый в роутере и автоматически подключает необходимые View и Models.
б) private function getModel($nameModel) - Функция автоподключения модели.
в) public function index() - Функция получения списка из базы данных. В функции по умолчанию задаётся количество страниц равное нулю, что является сигналом для вывода всех записей из заданной таблицы на экран. Если количество страниц задано явно, то выводятся строки в определённом диапазоне. Здесь же происходит проверка запроса на sql-инъекции.
г) public function add() - Функция добавления в базу данных. В качестве передаваемых далее параметров рассматривается неограниченный по размеру GET-массив. Массив GET проверяется на наличие каких-либо параметров для внесения в sql-таблицу, поэтому значение параметров должно быть больше единицы (поскольку добавление рассматривается как универсальная функция). Первым действием из него извлекается и удаляется часть, ответственная за путь роутера. Затем происходит проверка на sql-инъекции, полученные параметры передаются в модель.
д) public function delete() - Функция удаления из базы данных. В качестве передаваемого в модель параметра рассматривается id, проверяется на наличие инъекций и отправляется в модель.
е) public function editget() - Функция получения редактируемых данных из базы данных. В качестве передаваемого в модель параметра рассматривается id, проверяется на наличие инъекций и отправляется в модель.
ж) public function editput() - Функция обновления информации в базе данных. В качестве параметров, передаваемых в модель, рассматриваются GET-массив, из которого удаляется часть, связанная с путём из роутера, отдельно извлекается id изменяемой записи, а остальные параметры передаются в качестве данных, которые необходимо изменить.
з) public function convert($array) - Функция конвертирования полученного из модели ответа в json-массив. Так как модель не работает непосредственно с данными, то она возвращает только массив в определённом формате, а все его преобразования выполняются уже в контроллере.
2.1 Контроллеры-потомки содержат либо уникальные действия для каждого случая, либо информацию, необходимую классу Controller для функционирования (например, название таблицы).

3. Компонент View

Создается вызовом в родительском контроллере метода getInstance().
Если компонент уже был создан, при последующих вызовах getInstance() будет возвращен один и тот же обьект.

Компонент имеет метод setLayout($layout) принимающий название макета (находящийся по следующему пути '/app/views/layouts/') в виде строки без расширения.
Метод redirect($url) принимает строку. Используется для перенаправления пользователя после совершения какого-либо действия (создания пользователя, редактирование, прохождение курса).

Метод generate($template, $vars = []) принимает путь до UI, в качестве строки и массив данных(необязательно).
Формат данных:
3.1 $template - строка 
3.1.1 'папка/файл' без расширения
3.1.2 Пример: generate('user/index') /app/public/views/user/index.php
Принцип работы метода: 
3.2 Проверяет наличие подключаемого макета (заданного методом setLayout($layout))
3.3 Создает переменные и присваивает им значения из массива $vars[] по принципу $key => $value, вызывая функцию extract($vars)
3.3.1 Массив vars[] должен быть подготовлен в контроллере и передан в метод generate($title, $vars = [])
3.3.2 Пример использования vars = ['title' => 'Main page']
3.4 Проверяет наличие файла, отображающего интерфейс, переданного в качестве первого параметра метода generate($template)
3.4.1 Если файл присутствует, подключает его
3.4.2 Если файл отсутствует, выдает соответствующее сообщение пользователю
3.5 Подключает макет, с которым подтягиваются интерфейс и данные

Layout 'main' включает в себя вывод ошибок, используя суперглобальный массив $_POST['errors']
Для отображения ошибок (e.g. введение некорректных данных в форму), передавать в этот массив соответствующее сообщение.
$_POST['errors'][] = 'wrong name';
