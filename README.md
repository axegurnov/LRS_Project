# LRS_Project


LRS Project
by ImageSpark<br>

# Структура проекта

В корневом каталоге LRS_Project находятся несколько подкаталогов app, js, css, img
 - подкаталог app содержит основной модуль приложения
 - подкаталог css содержит все общедоступные CSS-файлы;
 - подкаталог js хранит общедоступные JavaScript-файлы;
    
 * public/
     * scs
     * js
 * app/
     * controllers/
     * core/
     * lib/
     * models/
     * views/
         * layouts/

  
Директория app содержит подкаталоги config, controllers, core, lib, models, views
 - подкаталог config содержит вспомогательныу файлы для отладки ошибок и осуществления миграции базы данных
 - подкаталог controllers содержит все контроллеры
 - подкаталог core содержит родительские классы Model, View, Controller
 - подкаталог lib содержит файлы подключаемых библиотек
 - подкаталог models содержит все необходимые модели
 - подкаталог views содержит все необходимые представления

=======
# Миграции

1. How to use Migrations
Create database name LRS. In file index.php uncommented //require 'app/config/Migration.php'.
Migrations in file /app/config/Migration.php.

# Компонент контроллер
1. Класс Controller - данный класс является родителем для всех контроллеров, используемых в программе. В него вынесены все основные функции, дублирующиеся в потомках.
Используемые параметры:
- $model, $view - подключаемые модели и вью соответственно
- $route - путь, принимаемый из роутера и используемый в качестве автоподключения модели и вью
- $table - сущность, указываемая при вызове дочернего контроллера и используемая далее в модели

<ul style='list-style-type: none;'>
    <li>1.1 public beforeAction() - Функция-фильтр контроля доступа, которая может проверять аутентификацию пользователя перед тем, как будет выполнено запрошенное действие.</li>
    <li>1.2 public function __construct($route) - Функция принимает в качестве параметра путь, задаваемый в роутере передаёт путь роутера в глобальную переменную для дальнейшей передачи контроллерам-потомкам.</li>
    <li>1.3 private function getModel($nameModel) - Функция автоподключения модели.</li>
    <li>1.4 public function migrationAction() - Функция для выполнения миграции БД.</li>
    <li>1.5 public function listAction() - Функция получения списка из базы данных. В функции по умолчанию задаётся количество страниц равное нулю, что является сигналом для вывода всех записей из заданной таблицы на экран. Если количество страниц задано явно, то выводятся строки в определённом диапазоне. Здесь же происходит проверка запроса на sql-инъекции. В качестве результата ожидается массив с данными БД.</li>
    <li>1.6 public function addAction() - Функция добавления в базу данных. В качестве передаваемых далее параметров рассматривается неограниченный по размеру GET-массив. Массив GET проверяется на наличие каких-либо параметров для внесения в sql-таблицу, поэтому значение параметров должно быть больше единицы (поскольку добавление рассматривается как универсальная функция). Первым действием из него извлекается и удаляется часть, ответственная за путь роутера. Затем происходит проверка на sql-инъекции, полученные параметры передаются в модель. В качестве результата ожидается массив с записью об успешности/провале произведённой операции.</li>
    <li>1.7 public function deleteAction() - Функция удаления из базы данных. В качестве передаваемого в модель параметра рассматривается id, проверяется на наличие инъекций и отправляется в модель. В качестве результата ожидается массив с записью об успешности/провале произведённой операции.</li>
    <li>1.8 public function editgetAction() - Функция получения редактируемых данных из базы данных. В качестве передаваемого в модель параметра рассматривается id, проверяется на наличие инъекций и отправляется в модель. В качестве результата ожидается массив, содержащий данные редактируемого пользователя.</li>
    <li>1.9 public function editputAction() - Функция обновления информации в базе данных. В качестве параметров, передаваемых в модель, рассматриваются GET-массив, из которого удаляется часть, связанная с путём из роутера, отдельно извлекается id изменяемой записи, а остальные параметры передаются в качестве данных, которые необходимо изменить. В качестве результата ожидается массив с записью об успешности/провале произведённой операции.</li>
    <li>1.10 public function convertToJson($array) - Функция конвертирования полученного из модели ответа в json-массив. Так как модель не работает непосредственно с данными, то она возвращает только массив в определённом формате, а все его преобразования выполняются уже в контроллере.</li>
    <li>1.11 public function redirect($url) - Функция возвращает переход на другую страницу без отправки заголовков.</li>
</ul>
2. Контроллеры-потомки содержат либо уникальные действия для каждого случая, либо информацию, необходимую классу Controller для функционирования (например, название таблицы). Также в них происходит подключение моделей и вью, необходимых для конкретного случая.
<ul style='list-style-type: none;'>
    <li>2.1 MigrationController - используется для работы с миграциями, содержит метод migrationAction().</li>
    <li>2.2 LrsController</li>
    <li>2.3 LrsClientController</li>
    <li>2.4 LrsStateController</li>
    <li>2.5 LrsStatementsController</li>
    <li>2.6 UserController</li>
</ul>

# Компонент View

Создается вызовом в родительском контроллере метода getInstance().
Если компонент уже был создан, при последующих вызовах getInstance() будет возвращен один и тот же обьект.

Компонент имеет метод setLayout($layout) принимающий название макета (находящийся по следующему пути '/app/views/layouts/') в виде строки без расширения.
Метод redirect($url) принимает строку. Используется для перенаправления пользователя после совершения какого-либо действия (создания пользователя, редактирование, прохождение курса).

Метод generate($template, $vars = []) принимает путь до UI, в качестве строки и массив данных(необязательно).
Формат данных:
<ul style='list-style-type: none;'>
    <li>3.1 $template - строка</li>
    <li>3.1.1 'папка/файл' без расширения</li>
    <li>3.1.2 Пример: generate('user/index') /app/views/user/index.php</li>
    <li>Принцип работы метода: </li>
    <li>3.2 Проверяет наличие подключаемого макета (заданного методом setLayout($layout))</li>
    <li>3.3 Создает переменные и присваивает им значения из массива $vars[] по принципу $key => $value, вызывая функцию extract($vars)</li>
    <li>3.3.1 Массив vars[] должен быть подготовлен в контроллере и передан в метод generate($title, $vars = [])</li>
    <li>3.3.2 Пример использования vars = ['title' => 'Main page']</li>
    <li>3.4 Проверяет наличие файла, отображающего интерфейс, переданного в качестве первого параметра метода generate($template)</li>
    <li>3.4.1 Если файл присутствует, подключает его</li>
    <li>3.4.2 Если файл отсутствует, выдает соответствующее сообщение пользователю</li>
    <li>3.5 Подключает макет, с которым подтягиваются интерфейс и данные</li>
</ul>

Layout 'main' включает в себя вывод ошибок, используя суперглобальный массив $_POST['errors']
Для отображения ошибок (e.g. введение некорректных данных в форму), передавать в этот массив соответствующее сообщение.
$_POST['errors'][] = 'wrong name';
